import{j as t}from"./ui-Dp5FSweD.js";import{a as d}from"./vendor-BxUyh3kO.js";import{c as z,u as M,X as T,a as $}from"./index-TKFawkw-.js";import{B as w}from"./button-BRAHZdsD.js";import{L as B,I as C}from"./select-DkMj81_h.js";import{U as E}from"./upload-DGJDyHk2.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=z("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),J=({onUpload:x,multiple:o=!1,entityType:m,entityId:p,maxFiles:h=10,className:D=""})=>{const[n,j]=d.useState(!1),[I,u]=d.useState(!1),[r,g]=d.useState([]),[N,y]=d.useState({}),f=d.useRef(null),{toast:c}=M(),b=e=>{if(!e)return;const s=Array.from(e).filter(i=>{const l=i.type.startsWith("image/"),U=i.size<=10*1024*1024;return l?U?!0:(c({title:"File too large",description:`${i.name} exceeds 10MB limit`,variant:"destructive"}),!1):(c({title:"Invalid file type",description:`${i.name} is not a valid image file`,variant:"destructive"}),!1)});if(o){if(r.length+s.length>h){c({title:"Too many files",description:`Maximum ${h} files allowed`,variant:"destructive"});return}g(l=>[...l,...s])}else g(s.slice(0,1))},v=e=>{e.preventDefault(),e.stopPropagation(),e.type==="dragenter"||e.type==="dragover"?u(!0):e.type==="dragleave"&&u(!1)},S=e=>{e.preventDefault(),e.stopPropagation(),u(!1),b(e.dataTransfer.files)},_=e=>{b(e.target.files)},k=e=>{g(a=>a.filter((s,i)=>i!==e)),y(a=>{const s={...a};return delete s[`file-${e}`],s})},F=(e,a)=>{y(s=>({...s,[`file-${e}`]:a}))},A=async()=>{if(r.length!==0){j(!0);try{let e=[];if(o&&r.length>1){const a=await $.images.uploadMultiple(r,m,p);a.data&&(e=a.data.map(s=>({id:0,filename:s.split("/").pop()||"",original_name:"",mime_type:"image/*",size:0,path:s,url:s,entity_type:m,entity_id:p,created_at:new Date().toISOString()})))}else for(let a=0;a<r.length;a++){const s=r[a],i=N[`file-${a}`],l=await $.images.upload(s,m,p,i);l.data&&e.push({id:0,filename:l.data.split("/").pop()||"",original_name:s.name,mime_type:s.type,size:s.size,path:l.data,url:l.data,alt_text:i,entity_type:m,entity_id:p,created_at:new Date().toISOString()})}c({title:"Upload successful",description:`${e.length} image(s) uploaded successfully`}),x==null||x(e),g([]),y({}),f.current&&(f.current.value="")}catch(e){console.error("Upload failed:",e),c({title:"Upload failed",description:e instanceof Error?e.message:"Unknown error occurred",variant:"destructive"})}finally{j(!1)}}};return t.jsxs("div",{className:`space-y-4 ${D}`,children:[t.jsxs("div",{className:`
          border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors
          ${I?"border-primary bg-primary/5":"border-gray-300 hover:border-gray-400"}
          ${n?"opacity-50 cursor-not-allowed":""}
        `,onDragEnter:v,onDragLeave:v,onDragOver:v,onDrop:S,onClick:()=>{var e;return!n&&((e=f.current)==null?void 0:e.click())},children:[t.jsx("input",{ref:f,type:"file",multiple:o,accept:"image/*",onChange:_,className:"hidden",disabled:n}),t.jsx(E,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),t.jsx("p",{className:"text-lg font-medium text-gray-900 mb-2",children:o?"Upload Images":"Upload Image"}),t.jsxs("p",{className:"text-sm text-gray-500",children:["Drag and drop ",o?"images":"an image"," here, or click to select"]}),t.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:["Supports: JPEG, PNG, WebP, GIF (max 10MB each)",o&&` â€¢ Max ${h} files`]})]}),r.length>0&&t.jsxs("div",{className:"space-y-3",children:[t.jsx("h4",{className:"font-medium text-gray-900",children:"Selected Files"}),t.jsx("div",{className:"space-y-2",children:r.map((e,a)=>t.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[t.jsx(L,{className:"h-8 w-8 text-gray-400 flex-shrink-0"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.name}),t.jsxs("p",{className:"text-xs text-gray-500",children:[(e.size/1024/1024).toFixed(2)," MB"]}),t.jsxs("div",{className:"mt-2",children:[t.jsx(B,{htmlFor:`alt-${a}`,className:"text-xs text-gray-600",children:"Alt text (optional)"}),t.jsx(C,{id:`alt-${a}`,type:"text",placeholder:"Describe this image...",value:N[`file-${a}`]||"",onChange:s=>F(a,s.target.value),className:"mt-1 text-xs",disabled:n})]})]}),t.jsx(w,{variant:"ghost",size:"sm",onClick:()=>k(a),disabled:n,className:"flex-shrink-0",children:t.jsx(T,{className:"h-4 w-4"})})]},a))})]}),r.length>0&&t.jsx("div",{className:"flex justify-end",children:t.jsx(w,{onClick:A,disabled:n||r.length===0,className:"min-w-[120px]",children:n?"Uploading...":`Upload ${r.length} file(s)`})})]})};export{J as I};
